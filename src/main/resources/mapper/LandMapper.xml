<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="koreatech.in.repository.LandMapper">

    <select id="getTotalCountByConditionForAdmin" parameterType="koreatech.in.dto.land.admin.request.LandsCondition" resultType="integer">
        SELECT COUNT(*)
        FROM `koin`.`lands`

        <trim prefix="WHERE" prefixOverrides="AND">
            <!-- 검색 -->
            <if test="condition.query != null">
                <trim prefix="AND">
                    <if test='condition.searchType.name().equals("NAME")'>
                        REPLACE(`name`, ' ', '')
                    </if>
                    LIKE CONCAT('%', REPLACE(#{condition.query}, ' ', ''), '%')
                </trim>
            </if>

            <!-- 필터링 -->
            <if test="!condition.filter.isEmpty()">
                <trim prefix="AND">
                    <foreach collection="condition.filter" item="item" separator="AND">
                        <if test='item.name().equals("IS_DELETED")'>`is_deleted` = 1</if>
                        <if test='item.name().equals("REFRIGERATOR")'>`opt_refrigerator` = 1</if>
                        <if test='item.name().equals("CLOSET")'>`opt_closet` = 1</if>
                        <if test='item.name().equals("TV")'>`opt_tv` = 1</if>
                        <if test='item.name().equals("MICROWAVE")'>`opt_microwave` = 1</if>
                        <if test='item.name().equals("GAS_RANGE")'>`opt_gas_range` = 1</if>
                        <if test='item.name().equals("INDUCTION")'>`opt_induction` = 1</if>
                        <if test='item.name().equals("WATER_PURIFIER")'>`opt_water_purifier` = 1</if>
                        <if test='item.name().equals("AIR_CONDITIONER")'>`opt_air_conditioner` = 1</if>
                        <if test='item.name().equals("WASHER")'>`opt_washer` = 1</if>
                        <if test='item.name().equals("BED")'>`opt_bed` = 1</if>
                        <if test='item.name().equals("DESK")'>`opt_desk` = 1</if>
                        <if test='item.name().equals("SHOE_CLOSET")'>`opt_shoe_closet` = 1</if>
                        <if test='item.name().equals("ELECTRONIC_DOOR_LOCKS")'>`opt_electronic_door_locks` = 1</if>
                        <if test='item.name().equals("BIDET")'>`opt_bidet` = 1</if>
                        <if test='item.name().equals("VERANDA")'>`opt_veranda` = 1</if>
                        <if test='item.name().equals("ELEVATOR")'>`opt_elevator` = 1</if>
                    </foreach>
                </trim>
            </if>
        </trim>
    </select>

    <select id="getLandsByConditionForAdmin" resultType="koreatech.in.dto.land.admin.response.LandsResponse$Land">
        SELECT *
        FROM `koin`.`lands`

        <trim prefix="WHERE" prefixOverrides="AND">
            <!-- 검색 -->
            <if test="condition.query != null">
                <trim prefix="AND">
                    <if test='condition.searchType.name().equals("NAME")'>
                        REPLACE(`name`, ' ', '')
                    </if>
                    LIKE CONCAT('%', REPLACE(#{condition.query}, ' ', ''), '%')
                </trim>
            </if>

            <!-- 필터링 -->
            <if test="!condition.filter.isEmpty()">
                <trim prefix="AND">
                    <foreach collection="condition.filter" item="item" separator="AND">
                        <if test='item.name().equals("IS_DELETED")'>`is_deleted` = 1</if>
                        <if test='item.name().equals("REFRIGERATOR")'>`opt_refrigerator` = 1</if>
                        <if test='item.name().equals("CLOSET")'>`opt_closet` = 1</if>
                        <if test='item.name().equals("TV")'>`opt_tv` = 1</if>
                        <if test='item.name().equals("MICROWAVE")'>`opt_microwave` = 1</if>
                        <if test='item.name().equals("GAS_RANGE")'>`opt_gas_range` = 1</if>
                        <if test='item.name().equals("INDUCTION")'>`opt_induction` = 1</if>
                        <if test='item.name().equals("WATER_PURIFIER")'>`opt_water_purifier` = 1</if>
                        <if test='item.name().equals("AIR_CONDITIONER")'>`opt_air_conditioner` = 1</if>
                        <if test='item.name().equals("WASHER")'>`opt_washer` = 1</if>
                        <if test='item.name().equals("BED")'>`opt_bed` = 1</if>
                        <if test='item.name().equals("DESK")'>`opt_desk` = 1</if>
                        <if test='item.name().equals("SHOE_CLOSET")'>`opt_shoe_closet` = 1</if>
                        <if test='item.name().equals("ELECTRONIC_DOOR_LOCKS")'>`opt_electronic_door_locks` = 1</if>
                        <if test='item.name().equals("BIDET")'>`opt_bidet` = 1</if>
                        <if test='item.name().equals("VERANDA")'>`opt_veranda` = 1</if>
                        <if test='item.name().equals("ELEVATOR")'>`opt_elevator` = 1</if>
                    </foreach>
                </trim>
            </if>
        </trim>

        <!-- 정렬 -->
        <if test="condition.sort != null">
            <trim prefix="ORDER BY">
                <if test='condition.sort.name().equals("NAME_ASC")'>`name` ASC</if>
                <if test='condition.sort.name().equals("NAME_DESC")'>`name` DESC</if>
                <if test='condition.sort.name().equals("CREATED_AT_ASC")'>`created_at` ASC</if>
                <if test='condition.sort.name().equals("CREATED_AT_DESC")'>`created_at` DESC</if>
            </trim>
        </if>

        <!-- 페이지네이션 -->
        LIMIT #{cursor}, #{condition.limit}
    </select>
</mapper>